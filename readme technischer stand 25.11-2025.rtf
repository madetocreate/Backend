{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fmodern\fcharset0 Courier;\f1\froman\fcharset0 Times-Roman;\f2\froman\fcharset0 Times-Bold;
\f3\fmodern\fcharset0 Courier-Bold;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red109\green109\blue109;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c50196\c50196\c50196;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid2\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid301\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid401\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid402\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{square\}}{\leveltext\leveltemplateid403\'01\uc0\u9642 ;}{\levelnumbers;}\fi-360\li2160\lin2160 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid601\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid602\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid701\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid702\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid801\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid802\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid9}
{\list\listtemplateid10\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid901\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid10}
{\list\listtemplateid11\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1001\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid11}
{\list\listtemplateid12\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid1102\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid12}
{\list\listtemplateid13\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid13}
{\list\listtemplateid14\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid14}
{\list\listtemplateid15\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid1402\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid15}
{\list\listtemplateid16\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid16}
{\list\listtemplateid17\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid1602\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid17}
{\list\listtemplateid18\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid1702\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid18}
{\list\listtemplateid19\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1801\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid19}
{\list\listtemplateid20\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1901\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid20}
{\list\listtemplateid21\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2001\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid21}
{\list\listtemplateid22\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid22}
{\list\listtemplateid23\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid23}
{\list\listtemplateid24\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid24}
{\list\listtemplateid25\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid25}
{\list\listtemplateid26\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid26}
{\list\listtemplateid27\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid2602\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid27}
{\list\listtemplateid28\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid2701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid2702\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{square\}}{\leveltext\leveltemplateid2703\'01\uc0\u9642 ;}{\levelnumbers;}\fi-360\li2160\lin2160 }{\listname ;}\listid28}
{\list\listtemplateid29\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid2801\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid2802\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid29}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}{\listoverride\listid10\listoverridecount0\ls10}{\listoverride\listid11\listoverridecount0\ls11}{\listoverride\listid12\listoverridecount0\ls12}{\listoverride\listid13\listoverridecount0\ls13}{\listoverride\listid14\listoverridecount0\ls14}{\listoverride\listid15\listoverridecount0\ls15}{\listoverride\listid16\listoverridecount0\ls16}{\listoverride\listid17\listoverridecount0\ls17}{\listoverride\listid18\listoverridecount0\ls18}{\listoverride\listid19\listoverridecount0\ls19}{\listoverride\listid20\listoverridecount0\ls20}{\listoverride\listid21\listoverridecount0\ls21}{\listoverride\listid22\listoverridecount0\ls22}{\listoverride\listid23\listoverridecount0\ls23}{\listoverride\listid24\listoverridecount0\ls24}{\listoverride\listid25\listoverridecount0\ls25}{\listoverride\listid26\listoverridecount0\ls26}{\listoverride\listid27\listoverridecount0\ls27}{\listoverride\listid28\listoverridecount0\ls28}{\listoverride\listid29\listoverridecount0\ls29}}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
# Aklow Backend \'96 System\'fcberblick & technischer Stand\
\
Stand: 2025-11-26\
\
Dieses Dokument beschreibt den aktuellen Stand des Aklow-Backends.  \
Ziel: Ein neuer Entwickler oder ein neuer GPT kann allein mit dieser Datei das Backend verstehen und sicher weiterentwickeln.\
\
---\
\
## 1. Ziel & Gesamtarchitektur\
\
Das Backend stellt eine schlanke HTTP-API bereit f\'fcr:\
\
- Chat-Funktionalit\'e4t (synchron + Streaming) \'fcber den **OpenAI Responses Orchestrator**.\
- Ingestion von E-Mails, Direct Messages (DMs) und Reviews in ein zentrales **Memory-System**, das aktuell in einen **OpenAI Vector Store** schreibt.\
- Zuk\'fcnftig: Auth, Usage/Billing, Memory-Suche und weitere Automatisierungs-Features.\
\
Technische Basis:\
\
- Node.js + TypeScript\
- Fastify (HTTP-Server)\
- OpenAI Node SDK (Responses + Vector Stores)\
- Zod (Validation)\
- Eigene Domain-Layer (chat, memory, ingest, vector, orchestrator, usage, auth, billing)\
\
---\
\
## 2. Projektstruktur (wichtige Dateien & Ordner)\
\
Unter `src/` liegen die relevanten Teile:\
\
- `src/server.ts`  \
  Einstiegspunkt, Fastify-App, Content-Type-Handling, Routen-Registrierung.\
\
- `src/config/env.ts`  \
  L\'e4dt ENV-Variablen (u. a. aus `~/Documents/Backend-Secrets/backend.env`) und validiert sie mit Zod. Wichtige Variablen:\
  - `NODE_ENV`\
  - `PORT` (Default 3000)\
  - `OPENAI_API_KEY`\
  - `OPENAI_PROJECT` (optional, f\'fcr OpenAI-Projekt-Kontext)\
  - `OPENAI_MODEL` (aktuelles Modell, z. B. `gpt-4.1`)\
\
- `src/integrations/openai/client.ts`  \
  Initialisiert den OpenAI-Client:\
\
  ```ts\
  import OpenAI from "openai";\
  import \{ env \} from "../../config/env";\
\
  export const openai = new OpenAI(\{\
    apiKey: env.OPENAI_API_KEY\
  \});\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls1\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 src/http/sse.ts
\f1\fs24 \uc0\u8232 Kleiner Helper zum Schreiben von Server-Sent-Events (SSE), z. B. f\'fcr 
\f0\fs26 /chat/stream
\f1\fs24 .\
\ls1\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 src/routes/
\f1\fs24 \uc0\u8232 Alle HTTP-Routen:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls1\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 chat.ts
\f1\fs24 \
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 chatStream.ts
\f1\fs24 \
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 ingestEmail.ts
\f1\fs24 \
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 ingestDm.ts
\f1\fs24 \
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 ingestReview.ts
\f1\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls1\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 src/domain/
\f1\fs24 \uc0\u8232 Domain-spezifische Logik:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls1\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 chat/
\f1\fs24  \'96 Request-Schema f\'fcr Chat.\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 ingest/
\f1\fs24  \'96 Zod-Schemas f\'fcr E-Mail, DM, Review.\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 orchestrator/
\f1\fs24  \'96 Orchestrator-Service + Summarizer (OpenAI Responses).\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 memory/
\f1\fs24  \'96 Memory-Types, Policy, Mapping und Write-Service.\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 vector/
\f1\fs24  \'96 VectorStore-Service (Tenant \uc0\u8594  VectorStore-ID, Upload).\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 usage/
\f1\fs24  \'96 Usage-Events (aktuell Stub).\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 auth/
\f1\fs24  \'96 Auth-Konzept (aktuell Stub).\
\ls1\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 billing/
\f1\fs24  \'96 Billing-Pl\'e4ne/Typen (Konzept, noch nicht aktiv).\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 3. HTTP-API \'96 Routen & Contracts\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 3.1 GET 
\f3\fs30\fsmilli15210 /health
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/server.ts
\f1\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls2\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Zweck: einfacher Gesundheitscheck f\'fcr Monitoring/Load-Balancer.\
\ls2\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Response:\uc0\u8232 
\f0\fs26 \{ "status": "ok" \}\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls2\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Keine Auth, keine Abh\'e4ngigkeiten.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 \strokec2 3.2 POST 
\f3\fs30\fsmilli15210 /chat
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/routes/chat.ts
\f1\fs24 \uc0\u8232 
\f2\b Domain-Schema:
\f1\b0  
\f0\fs26 src/domain/chat/schema.ts
\f1\fs24 \

\f2\b Request-Body (
\f3\fs26 ChatRequestSchema
\f2\fs24 ):
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  tenantId: string;\
  sessionId: string;\
  channel: string;\
  message: string;\
  metadata?: Record<string, unknown>;\
\}\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls3\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 tenantId
\f1\fs24  \'96 Mandant / Kunde.\
\ls3\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 sessionId
\f1\fs24  \'96 Gespr\'e4chs-ID (Konversationskontext).\
\ls3\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 channel
\f1\fs24  \'96 z. B. 
\f0\fs26 "app"
\f1\fs24 , 
\f0\fs26 "website"
\f1\fs24  \'96 aktuell nur als Info.\
\ls3\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 message
\f1\fs24  \'96 User-Input.\
\ls3\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 metadata
\f1\fs24  \'96 beliebige Zusatzinfos (z. B. 
\f0\fs26 summarize: true
\f1\fs24 ).\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b \cf0 Ablauf:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls4\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Zod-Validation via 
\f0\fs26 ChatRequestSchema.safeParse
\f1\fs24 .\
\ls4\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Bei Erfolg: Aufruf 
\f0\fs26 createResponse(parsed.data)
\f1\fs24  aus 
\f0\fs26 domain/orchestrator/service.ts
\f1\fs24 .\
\ls4\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Ergebnis wird 1:1 zur\'fcckgegeben.\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b \cf0 Response (aktueller Stand):
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  "tenantId": "tenant_demo",\
  "sessionId": "sess_001",\
  "channel": "app",\
  "content": "\'85Antwort vom Orchestrator\'85"\
\}\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 \strokec2 3.3 POST 
\f3\fs30\fsmilli15210 /chat/stream
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/routes/chatStream.ts
\f1\fs24 \uc0\u8232 
\f2\b Domain-Schema:
\f1\b0  
\f0\fs26 src/domain/chat/schema.ts
\f1\fs24  (gleicher Body wie 
\f0\fs26 /chat
\f1\fs24 )\

\f2\b Zweck:
\f1\b0 \uc0\u8232 Chat mit Streaming \'fcber 
\f2\b Server-Sent Events
\f1\b0  (SSE).\

\f2\b Ablauf:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls5\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Request-Body wird mit 
\f0\fs26 ChatRequestSchema
\f1\fs24  validiert.\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Bei Erfolg:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls5\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Response-Header gesetzt:\
\pard\tx1660\tx2160\pardeftab720\li2160\fi-2160\sa240\partightenfactor0
\ls5\ilvl2
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9642 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Content-Type: text/event-stream
\f1\fs24 \
\ls5\ilvl2
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9642 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Cache-Control: no-cache
\f1\fs24 \
\ls5\ilvl2
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9642 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Connection: keep-alive
\f1\fs24 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls5\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeSse(reply, "start", \{ started: true \})
\f1\fs24 .\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls5\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Aufruf 
\f0\fs26 createStreamingResponse(parsed.data)
\f1\fs24  aus 
\f0\fs26 domain/orchestrator/service.ts
\f1\fs24 .\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Das zur\'fcckgegebene 
\f0\fs26 stream: AsyncIterable<any>
\f1\fs24  wird iteriert:\uc0\u8232 
\f0\fs26 for await (const event of stream) \{\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls5\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	5	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   if (event.type === "response.output_text.delta") \{\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	6	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     const delta = typeof event.delta === "string" ? event.delta : "";\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	7	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     if (delta) \{\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	8	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2       writeSse(reply, "chunk", \{ content: delta \});\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	9	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     \}\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	10	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   \}\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	11	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \}\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls5\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	12	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls5\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	13	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Zum Abschluss:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls5\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeSse(reply, "end", \{ done: true \})
\f1\fs24 \
\ls5\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 reply.raw.end()
\f1\fs24 .\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b \cf0 SSE-Events:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls6\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 event: start
\f1\fs24  \'96 Startsignal.\
\ls6\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 event: chunk
\f1\fs24  \'96 Token-Deltas, jeweils JSON 
\f0\fs26 \{ content: "<teiltext>" \}
\f1\fs24 .\
\ls6\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 event: end
\f1\fs24  \'96 Abschluss.\
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Der Client muss selbst die Chunks zusammenkonkatenieren, um den vollst\'e4ndigen Text zu erhalten.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 \strokec2 3.4 POST 
\f3\fs30\fsmilli15210 /ingest/email
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/routes/ingestEmail.ts
\f1\fs24 \uc0\u8232 
\f2\b Schema:
\f1\b0  
\f0\fs26 IngestEmailBodySchema
\f1\fs24  in 
\f0\fs26 src/domain/ingest/schema.ts
\f1\fs24 \

\f2\b Request-Body:
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  tenantId: string;\
  externalId: string;\
  from: string;\
  to: string;\
  subject?: string;\
  body: string;\
  channel?: string;\
  metadata?: Record<string, any>;\
\}\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b\fs24 \cf0 Ablauf:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls7\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 IngestEmailBodySchema.safeParse(request.body)
\f1\fs24 .\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls7\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Bei Fehler:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls7\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 HTTP 400,\
\ls7\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Body: 
\f0\fs26 \{ "error": "invalid_body" \}
\f1\fs24 .\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls7\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Bei Erfolg:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls7\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 recordUsageEvent(...)
\f1\fs24  wird aufgerufen (aktuell No-Op).\
\ls7\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeMemory(mapEmailToMemory(parsed.data))
\f1\fs24  \'96 schreibt den Inhalt in das Memory-System (VectorStore).\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls7\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Response:\
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  "status": "accepted",\
  "type": "email",\
  "tenantId": "...",\
  "normalized": \{\
    "externalId": "...",\
    "from": "...",\
    "to": "...",\
    "subject": "..." | null,\
    "body": "...",\
    "channel": "..." | null,\
    "metadata": \{ ... \} | null\
  \}\
\}\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b\fs24 \cf0 Wichtig:
\f1\b0 \uc0\u8232 Alle 
\f0\fs26 ingest/*
\f1\fs24 -Routen nutzen 
\f0\fs26 mapXxxToMemory(...)
\f1\fs24  + 
\f0\fs26 writeMemory(...)
\f1\fs24  \uc0\u8594  zentraler Memory-Eingang.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 \strokec2 3.5 POST 
\f3\fs30\fsmilli15210 /ingest/dm
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/routes/ingestDm.ts
\f1\fs24 \uc0\u8232 
\f2\b Schema:
\f1\b0  
\f0\fs26 IngestDmBodySchema
\f1\fs24  in 
\f0\fs26 src/domain/ingest/schema.ts
\f1\fs24 \

\f2\b Request-Body:
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  tenantId: string;\
  externalId: string;\
  platform: string;             // z. B. "instagram", "facebook", "whatsapp"\
  from: string;\
  to?: string;\
  body: string;\
  channel?: string;\
  metadata?: Record<string, any>;\
\}\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b\fs24 \cf0 Ablauf:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls8\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Zod-Validation via 
\f0\fs26 IngestDmBodySchema
\f1\fs24 .\
\ls8\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Fehler \uc0\u8594  HTTP 400 + 
\f0\fs26 \{ "error": "invalid_body" \}
\f1\fs24 .\
\ls8\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Erfolg:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls8\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 recordUsageEvent(\{ type: "ingest_dm", ... \})
\f1\fs24 .\
\ls8\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeMemory(mapDmToMemory(parsed.data))
\f1\fs24 .\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls8\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Response:\
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  "status": "accepted",\
  "type": "dm",\
  "tenantId": "...",\
  "normalized": \{\
    "externalId": "...",\
    "platform": "...",\
    "from": "...",\
    "to": "..." | null,\
    "body": "...",\
    "channel": "..." | null,\
    "metadata": \{ ... \} | null\
  \}\
\}\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 \strokec2 3.6 POST 
\f3\fs30\fsmilli15210 /ingest/review
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/routes/ingestReview.ts
\f1\fs24 \uc0\u8232 
\f2\b Schema:
\f1\b0  
\f0\fs26 IngestReviewBodySchema
\f1\fs24  in 
\f0\fs26 src/domain/ingest/schema.ts
\f1\fs24 \

\f2\b Request-Body:
\f1\b0 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  tenantId: string;\
  externalId: string;\
  sourcePlatform: string;   // z. B. "trustpilot", "google", "app_store"\
  rating: number;\
  authorName?: string;\
  body: string;\
  createdAt?: string;\
  metadata?: Record<string, any>;\
\}\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b\fs24 \cf0 Ablauf:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls9\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Zod-Validation via 
\f0\fs26 IngestReviewBodySchema
\f1\fs24 .\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Fehler \uc0\u8594  HTTP 400 + 
\f0\fs26 \{ "error": "invalid_body" \}
\f1\fs24 .\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Erfolg:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls9\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 recordUsageEvent(\{ type: "ingest_review", ... \})
\f1\fs24 .\
\ls9\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeMemory(mapReviewToMemory(parsed.data))
\f1\fs24 .\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls9\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Response:\
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 \{\
  "status": "accepted",\
  "type": "review",\
  "tenantId": "...",\
  "normalized": \{\
    "externalId": "...",\
    "sourcePlatform": "...",\
    "rating": 5,\
    "authorName": "..." | null,\
    "body": "...",\
    "createdAt": "..." | null,\
    "metadata": \{ ... \} | null\
  \}\
\}\
\pard\pardeftab720\partightenfactor0

\f1\fs24 \cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 4. Orchestrator & OpenAI-Integration\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/orchestrator/service.ts
\f1\fs24 \
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 4.1 Typ 
\f3\fs30\fsmilli15210 OrchestratorInput
\f2\fs28 \
\pard\pardeftab720\sa240\partightenfactor0

\f1\b0\fs24 \cf0 Direkt im 
\f0\fs26 service.ts
\f1\fs24  definiert:\
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 export type OrchestratorInput = \{\
  tenantId: string;\
  sessionId: string;\
  channel: string;\
  message: string;\
  metadata?: Record<string, unknown>;\
\};\
\pard\pardeftab720\sa240\partightenfactor0

\f1\fs24 \cf0 Wird aktuell 1:1 aus 
\f0\fs26 ChatRequestBody
\f1\fs24  bef\'fcllt.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 4.2 
\f3\fs30\fsmilli15210 createResponse
\f2\fs28  (synchroner Chat)\
\pard\pardeftab720\sa240\partightenfactor0

\f1\b0\fs24 \cf0 Ablauf:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls10\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Holt VectorStore-ID per 
\f0\fs26 getVectorStoreId(input.tenantId)
\f1\fs24 .\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Pr\'fcft Sonderfall 
\f2\b Summarizer
\f1\b0 :\uc0\u8232 
\f0\fs26 if (input.metadata && input.metadata.summarize) \{\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   const summary = await summarizeText(input.message);\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   return \{\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	5	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     tenantId: input.tenantId,\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	6	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     sessionId: input.sessionId,\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	7	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     channel: input.channel,\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	8	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     content: summary\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	9	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   \};\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	10	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \}\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	11	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls10\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	12	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Normale Chat-Antwort via 
\f0\fs26 openai.responses.create
\f1\fs24 :\uc0\u8232 
\f0\fs26 const response = await openai.responses.create(\{\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	13	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   model: "gpt-4.1",\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	14	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   input: [\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	15	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     \{\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	16	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2       role: "system",\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	17	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2       content: "You are the Aklow Orchestrator. Behave like ChatGPT but focused on business clarity."\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	18	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     \},\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	19	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     \{ role: "user", content: input.message \}\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	20	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   ],\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	21	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   tools: [\{ type: "file_search", vector_store_ids: [vectorStoreId] \}]\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	22	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \});\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	23	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls10\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	24	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 R\'fcckgabe:\uc0\u8232 
\f0\fs26 return \{\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	25	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   tenantId: input.tenantId,\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	26	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   sessionId: input.sessionId,\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	27	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   channel: input.channel,\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	28	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   content: response.output_text\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	29	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \};\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	30	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\sa240\partightenfactor0

\f2\b \cf0 Wichtig:
\f1\b0 \uc0\u8232 Hier wird der OpenAI 
\f2\b Responses-Orchestrator
\f1\b0  genutzt \'96 nicht mehr 
\f0\fs26 chat.completions
\f1\fs24 .\uc0\u8232 Tools: 
\f0\fs26 file_search
\f1\fs24  mit dem VectorStore des Tenants.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 4.3 
\f3\fs30\fsmilli15210 createStreamingResponse
\f2\fs28  (Streaming)\
\pard\pardeftab720\partightenfactor0

\f0\b0\fs26 \cf0 export async function createStreamingResponse(input: OrchestratorInput) \{\
  const vectorStoreId = await getVectorStoreId(input.tenantId);\
\
  const response = await openai.responses.create(\{\
    model: "gpt-4.1",\
    input: [\
      \{ role: "system", content: "You are the Aklow Orchestrator. Behave like ChatGPT but focused on business clarity." \},\
      \{ role: "user", content: input.message \}\
    ],\
    tools: [\{ type: "file_search", vector_store_ids: [vectorStoreId] \}],\
    stream: true\
  \});\
\
  return response;\
\}\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls11\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Gibt ein 
\f0\fs26 AsyncIterable
\f1\fs24  von 
\f0\fs26 ResponseStreamEvent
\f1\fs24 s zur\'fcck.\
\ls11\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 In der Route werden aktuell nur Events vom Typ 
\f0\fs26 "response.output_text.delta"
\f1\fs24  ausgewertet und als SSE gestreamt.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 4.4 Summarizer\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/orchestrator/summary.ts
\f1\fs24 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 import \{ openai \} from "../../integrations/openai/client";\
\
export async function summarizeText(text: string) \{\
  const r = await openai.responses.create(\{\
    model: "gpt-4.1",\
    input: [\
      \{ role: "system", content: "Summarize the following conversation into a compact business-ready memory snippet." \},\
      \{ role: "user", content: text \}\
    ]\
  \});\
\
  return r.output_text || "";\
\}\
\pard\pardeftab720\sa240\partightenfactor0

\f1\fs24 \cf0 Trigger-Bedingung: 
\f0\fs26 metadata.summarize === true
\f1\fs24  im Chat-Request.\uc0\u8232 Typische Nutzung: Tickets/Kundenf\'e4lle komprimiert als Memory-Snippet speichern.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 5. Memory & VectorStore\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 5.1 Memory-Service\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/memory/service.ts
\f1\fs24 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 import \{ MemoryWriteRequest \} from "./types";\
import \{ uploadTextToVectorStore \} from "../vector/service";\
\
export async function writeMemory(request: MemoryWriteRequest) \{\
  const text = typeof request.content === "string"\
    ? request.content\
    : String(request.content ?? "");\
\
  await uploadTextToVectorStore(request.tenantId, text);\
\}\
\
export async function searchMemory() \{\
  return [];\
\}\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls12\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeMemory
\f1\fs24 :\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls12\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Extrahiert den Text-Inhalt aus 
\f0\fs26 request.content
\f1\fs24 .\
\ls12\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Schiebt diesen Text in den VectorStore des Tenants.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls12\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 searchMemory
\f1\fs24 :\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls12\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Aktuell Stub \uc0\u8594  R\'fcckgabe 
\f0\fs26 []
\f1\fs24 .\
\ls12\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Geplant: sp\'e4ter VectorStore-/Hybrid-Suche.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 5.2 Memory-Mapping\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/memory/memoryMapping.ts
\f1\fs24 \
Enth\'e4lt Funktionen wie:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls13\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 mapEmailToMemory(emailBody: IngestEmailBody) \uc0\u8594  MemoryWriteRequest
\f1\fs24 \
\ls13\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 mapDmToMemory(dmBody: IngestDmBody) \uc0\u8594  MemoryWriteRequest
\f1\fs24 \
\ls13\ilvl0
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 mapReviewToMemory(reviewBody: IngestReviewBody) \uc0\u8594  MemoryWriteRequest
\f1\fs24 \
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Idee:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls14\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Vereinheitlicht, wie E-Mails, DMs und Reviews in Memory-Objekte \'fcbersetzt werden.\
\ls14\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Setzt 
\f0\fs26 type
\f1\fs24  (z. B. 
\f0\fs26 "email"
\f1\fs24 , 
\f0\fs26 "dm"
\f1\fs24 , 
\f0\fs26 "review"
\f1\fs24 ) und Metadaten (tenant, channel, IDs, Ratings etc.).\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 5.3 Memory-Policy\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/memory/policy.ts
\f1\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls15\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Definiert, welche Memory-Typen:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls15\ilvl1
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 lokal
\f1\b0  gespeichert werden sollen,\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls15\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 in den 
\f2\b VectorStore
\f1\b0  wandern sollen.\
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Aktueller Implementierungsstand:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls16\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Policy ist entworfen,\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls16\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeMemory
\f1\fs24  nutzt sie noch nicht (direkter VectorStore-Write).\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 6. VectorStore-Service\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/vector/service.ts
\f1\fs24 \
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf0 import \{ openai \} from "../../integrations/openai/client";\
import \{ toFile \} from "openai/uploads";\
\
const storeCache: Record<string, string> = \{\};\
\
export async function getVectorStoreId(tenantId: string) \{\
  if (storeCache[tenantId]) return storeCache[tenantId];\
  return await ensureVectorStore(tenantId);\
\}\
\
export async function ensureVectorStore(tenantId: string) \{\
  const store = await openai.vectorStores.create(\{\
    name: `aklow-$\{tenantId\}`\
  \});\
  storeCache[tenantId] = store.id;\
  return store.id;\
\}\
\
export async function uploadTextToVectorStore(tenantId: string, text: string) \{\
  const storeId = await getVectorStoreId(tenantId);\
  const file = await toFile(Buffer.from(text, "utf-8"), "memory.txt", \{ type: "text/plain" \});\
  const result = await openai.vectorStores.files.upload(storeId, file);\
  return result;\
\}\
\pard\pardeftab720\sa240\partightenfactor0

\f2\b\fs24 \cf0 Wichtig:
\f1\b0 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls17\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Pro 
\f0\fs26 tenantId
\f1\fs24  wird ein eigener VectorStore erstellt (
\f0\fs26 aklow-<tenantId>
\f1\fs24 ).\
\ls17\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Eine einfache In-Memory-Cache-Map (
\f0\fs26 storeCache
\f1\fs24 ) vermeidet Mehrfachanfragen.\
\ls17\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Upload:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls17\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Text \uc0\u8594  
\f0\fs26 Buffer
\f1\fs24  \uc0\u8594  
\f0\fs26 toFile(...)
\f1\fs24  \uc0\u8594  
\f0\fs26 files.upload(storeId, file)
\f1\fs24 .\
\ls17\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Der fr\'fchere Fehler mit 
\f0\fs26 file[file][0]
\f1\fs24  usw. (falscher Payload) ist in diesem Stand bereits behoben.\
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Zus\'e4tzlich gibt es in 
\f0\fs26 src/domain/vector/
\f1\fs24  noch Konfig/Typen f\'fcr eine komplexere Domain-basierte Struktur (z. B. nach 
\f0\fs26 MemoryDomain
\f1\fs24  getrennte Stores), die aktuell noch nicht aktiv genutzt wird.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 7. Usage, Auth, Billing \'96 Status\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 7.1 Usage\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/usage/service.ts
\f1\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls18\ilvl0
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 recordUsageEvent(event)
\f1\fs24  ist derzeit ein 
\f2\b Stub
\f1\b0  (No-Op).\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls18\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Routen rufen diese Funktion bereits auf:\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls18\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 /ingest/email
\f1\fs24 , 
\f0\fs26 /ingest/dm
\f1\fs24 , 
\f0\fs26 /ingest/review
\f1\fs24 .\
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Geplant:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls19\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Sp\'e4ter Logging und Metriken pro Tenant (Requests, Tokenverbrauch, etc.).\
\ls19\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Basis f\'fcr Billing/Rate-Limits.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 7.2 Auth\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/domain/auth/service.ts
\f1\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls20\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Token-Verify (
\f0\fs26 verifyAuthToken
\f1\fs24 ) ist noch nicht implementiert.\
\ls20\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Aktuell sind die Routen 
\f2\b nicht gesch\'fctzt
\f1\b0  (No-Auth-Szenario).\
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Geplant:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls21\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 JWT oder \'e4hnliches f\'fcr Tenant/User-Auth.\
\ls21\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Rollen-Handling (
\f0\fs26 AuthRole
\f1\fs24 ) bereits typisiert.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 7.3 Billing\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Dateien:
\f1\b0  
\f0\fs26 src/domain/billing/plans.ts
\f1\fs24 , 
\f0\fs26 src/domain/billing/types.ts
\f1\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls22\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Modelle und Pl\'e4ne sind definiert, aber nicht in die Routen/Usage integriert.\
\ls22\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Sp\'e4ter: Verkn\'fcpfung mit Usage-Events, Limitierung, Upgrades.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 8. Content-Type-Handling & Sicherheit\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 Datei:
\f1\b0  
\f0\fs26 src/server.ts
\f1\fs24 \
Wichtige Punkte:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls23\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Alle Content-Type-Parser werden zun\'e4chst entfernt:
\f1\b0 \uc0\u8232 
\f0\fs26 app.removeAllContentTypeParsers();\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls23\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls23\ilvl0
\f3\b\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 multipart/form-data
\f2\fs24  wird explizit blockiert:
\f1\b0 \uc0\u8232 
\f0\fs26 app.removeContentTypeParser("multipart/form-data");\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls23\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls23\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Eigener JSON-Parser:
\f1\b0 \uc0\u8232 
\f0\fs26 app.addContentTypeParser("application/json", \{ parseAs: "string" \}, (req, body, done) => \{\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls23\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   try \{\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     const jsonString = typeof body === "string" ? body : body.toString("utf8");\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     const parsed = JSON.parse(jsonString);\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     done(null, parsed);\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   \} catch (e) \{\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2     done(e as any);\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   \}\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \});\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls23\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls23\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Catch-all f\'fcr alle anderen Content-Types:
\f1\b0 \uc0\u8232 
\f0\fs26 app.addContentTypeParser("*", (_req, _body, done) => \{\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls23\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2   done(new Error("invalid_content_type"));\
\ls23\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \});\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls23\ilvl0
\f1\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\sa240\partightenfactor0
\cf0 Konsequenz:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls24\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 API akzeptiert nur noch 
\f0\fs26 application/json
\f1\fs24  mit g\'fcltigem JSON-Body.\
\ls24\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Alles andere wird abgewiesen \uc0\u8594  reduziert Angriffsfl\'e4che.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 9. Server-Start & Laufzeit\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 9.1 Dev-Modus\
\pard\pardeftab720\sa240\partightenfactor0

\f1\b0\fs24 \cf0 Typischer Start (z. B. via 
\f0\fs26 npm run dev
\f1\fs24 ):\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls25\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 L\'e4uft mit 
\f0\fs26 ts-node-dev
\f1\fs24 .\
\ls25\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Fastify h\'f6rt auf 
\f0\fs26 0.0.0.0:3000
\f1\fs24 .\
\ls25\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Log 
\f0\fs26 Server listening
\f1\fs24  signalisert funktionierenden Start.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 9.2 Health-Check\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls26\ilvl0
\f0\b0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 GET /health
\f1\fs24  \uc0\u8594  
\f0\fs26 \{ "status": "ok" \}
\f1\fs24 .\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa298\partightenfactor0

\f2\b\fs36 \cf0 \strokec2 10. Aktueller Stand & offene Baustellen\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 10.1 Was funktioniert stabil\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls27\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Chat (sync):
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls27\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 /chat
\f1\fs24  mit OpenAI Responses Orchestrator, inkl. 
\f0\fs26 file_search
\f1\fs24 -Tool auf Tenant-VectorStore.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls27\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Chat (streaming):
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls27\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 /chat/stream
\f1\fs24  mit SSE, Responses-Eventstream (
\f0\fs26 response.output_text.delta
\f1\fs24 ).\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls27\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Summarizer:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls27\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 metadata.summarize: true
\f1\fs24  im Chat-Request triggert kurzen summary-Text (via Responses API).\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls27\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Ingest + Memory + VectorStore:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls27\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 /ingest/email
\f1\fs24 , 
\f0\fs26 /ingest/dm
\f1\fs24 , 
\f0\fs26 /ingest/review
\f1\fs24  validieren per Zod und schreiben via 
\f0\fs26 writeMemory
\f1\fs24  in den OpenAI VectorStore.\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls27\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 VectorStore-Upload ist API-konform (kein 400er \'84Additional properties\'85\'93 mehr).\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls27\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Content-Type-Handling:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls27\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Strict JSON-only, sonst Fehler.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 10.2 Was bewusst noch rudiment\'e4r ist\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls28\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Memory-Suche (
\f3\fs26 searchMemory
\f2\fs24 )
\f1\b0 :\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls28\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Aktuell 
\f0\fs26 return []
\f1\fs24 .\
\ls28\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Geplant: VectorStore-Suche (und sp\'e4ter Hybrid mit lokaler DB).\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls28\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Memory-Policy:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls28\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Policy ist definiert, wird aber von 
\f0\fs26 writeMemory
\f1\fs24  noch nicht angewendet:\
\pard\tx1660\tx2160\pardeftab720\li2160\fi-2160\sa240\partightenfactor0
\ls28\ilvl2\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9642 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Noch keine Trennung zwischen \'84lokal speichern\'93 und \'84nur VectorStore\'93.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls28\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 VectorStore-Strategie:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls28\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Derzeit: 
\f2\b ein Store pro Tenant
\f1\b0 .\
\ls28\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Entwurf: Pro Tenant + Domain (emails, reviews, dms, business_profile, \'85).\
\ls28\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Konfig/Typen sind vorhanden, aber Service nutzt sie noch nicht.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls28\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Auth:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls28\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Keine Authentifizierung/Autorisierung aktiv.\
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls28\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 verifyAuthToken
\f1\fs24  ist noch nicht implementiert.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls28\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Usage & Billing:
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls28\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Usage-Events werden zwar an zentraler Stelle aufgerufen, aber noch nicht persistiert.\
\ls28\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Billing-Pl\'e4ne existieren nur als Struktur.\
\pard\pardeftab720\sa280\partightenfactor0

\f2\b\fs28 \cf0 10.3 N\'e4chste sinnvolle Schritte\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls29\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 API-Contracts finalisieren
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls29\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 DM/Review-Schemas an reale Datenquellen (z. B. Social-Media-APIs) anpassen.\
\ls29\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Konsistente Verwendung von 
\f0\fs26 platform
\f1\fs24  / 
\f0\fs26 channel
\f1\fs24  / 
\f0\fs26 sourcePlatform
\f1\fs24 .\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls29\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Memory-Policy & Search implementieren
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls29\ilvl1
\f0\fs26 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 writeMemory
\f1\fs24  so erweitern, dass Policy greift (lokal vs. VectorStore).\
\ls29\ilvl1
\f0\fs26 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 searchMemory
\f1\fs24  mit VectorStore-Suche hinterlegen.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls29\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Orchestrator-Prompt erweitern
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls29\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Systemprompt mit Tenant-/Channel-Spezifika anreichern.\
\ls29\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Optional: Memory-Signale (z. B. letzte E-Mails/Reviews eines Kunden) einbeziehen.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls29\ilvl0
\f2\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Auth & Usage produktionsreif machen
\f1\b0 \
\pard\tx940\tx1440\pardeftab720\li1440\fi-1440\sa240\partightenfactor0
\ls29\ilvl1\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Auth-Token pr\'fcfen und Tenant-Kontext sauber absichern.\
\ls29\ilvl1\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u9702 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Usage persistieren und sp\'e4ter mit Billing verkn\'fcpfen.\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 \
\pard\pardeftab720\sa240\partightenfactor0
\cf0 \strokec2 Dieses Dokument spiegelt den Stand nach erfolgreichem Debugging der VectorStore-Integration, des Responses-Orchestrators und der Ingest-Routen wider.\uc0\u8232 
\f0\fs26 \
}